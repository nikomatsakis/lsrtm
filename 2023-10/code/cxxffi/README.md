This code taken from the cxx demo
